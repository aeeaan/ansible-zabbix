---
- name: install zabbix repo rpm
  yum: name=http://repo.zabbix.com/zabbix/2.4/rhel/7/x86_64/zabbix-release-2.4-1.el7.noarch.rpm state=present
  when: ansible_os_family == 'RedHat' and ansible_distribution_major_version|int == 7

- name: create zabbix group
  group: name=zabbix gid=130 state=present

- name: create zabbix user
  user: name=zabbix uid=130 group=zabbix comment="Zabbix Monitoring System" home=/var/lib/zabbix shell=/sbin/nologin state=present

- name: ensure time zone is set
  ini_file: dest=/etc/php.ini section="Date" option="date.timezone" value="America/New_York"

- name: enable selinux
  selinux: policy=targeted state=enforcing

- name: initialize database
  include: db.yml
  when: zabbix_server_install == true or zabbix_proxy_install == true

- name: setup zabbix server
  include: server.yml
  when: zabbix_server_install == true

- name: setup zabbix proxy
  include: proxy.yml
  when: zabbix_proxy_install == true

- name: setup zabbix frontend
  include: frontend.yml
  when: zabbix_frontend_install == true

- name: setup zabbix agent
  include: agent.yml
  when: zabbix_agent_install == true
